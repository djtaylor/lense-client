%define name        cloudscape-common
%define major       $MAJOR
%define minor       $MINOR
%define release     $RELEASE
%define buildpath   $BUILDPATH
%define arch        noarch

Summary:            CloudScape Common Libraries
Name:               %{name}
Version:            %{major}.%{minor}
Release:            %{release}
Vendor:             VPLS
Source0:            /opt/cloudscape/build/tmp/%{buildpath}.tar.gz
License:            GPLv3
Group:              System Management
BuildArch:          %{arch}
Requires:           python-paramiko, python-crypto

%description
Common libraries used by the CloudScape client, agent, and server packages.

%prep
%setup -q -n %{buildpath}

%install

# Copy the build directory contents to the build root
cp -a $RPM_BUILD_DIR/%{buildpath}/* $RPM_BUILD_ROOT/.

%clean
rm -rf $RPM_BUILD_ROOT

%post

# Profile source / destination
PROFILE_SRC="$RPM_BUILD_ROOT/opt/cloudscape/_local/etc/profile.d/cloudscape.sh"
PROFILE_DST="$RPM_BUILD_ROOT/etc/profile.d/cloudscape.sh"

# Environment profile script
if [ ! -h $PROFILE_DST ]; then
	ln -s $PROFILE_SRC $PROFILE_DST
else
	echo -e "File '$PROFILE_DST' already exists, skipping deployment"
fi

%postun

# Profile configuration
PROFILE_CONFIG="$RPM_BUILD_ROOT/etc/profile.d/cloudscape.sh"

# Remove the old profile configuration
[ -h $PROFILE_CONFIG ] && rm -f $PROFILE_CONFIG

%files
%defattr(-,root,root)
/opt/cloudscape/*

%changelog
