#!/bin/bash
# CloudScape Agent: Post-removal Script

# Sudoers configuration
SUDOERS_CONFIG="/etc/sudoers.d/cloudscape-agent"

# Agent executable
AGENT_EXE="/usr/bin/cloudsape-agent"

# Init script
INIT_SCRIPT="/etc/init.d/cloudscape-agent"

# Remove the sudoers drop-in configuration file
[ -f $SUDOERS_DST ] && rm -f $SUDOERS_CONFIG

# Remove the agent executable
[ -f $AGENT_EXE ] && rm -f $AGENT_EXE

# Remove the init script
[ -f $INIT_SCRIPT ] && rm -f $INIT_SCRIPT

# Remove the cloudscape user account
if [ ! -z "$(cat /etc/passwd | grep -e "^cloudscape:.*$")" ]; then
	userdel -r cloudscape &> /dev/null
	
	# Failed to delete the user account
	if [ "$?" != "0" ]; then
		echo -e "Failed to remove the 'cloudscape' user account"	
	fi
fi

exit 0